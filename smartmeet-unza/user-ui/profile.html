<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Profile - SmartMeet UNZA</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body class="bg-gray-100">
    <div class="flex min-h-screen">
        <!-- Sidebar -->
        <div id="sidebar-container" class="h-full"></div>

        <!-- Main Content -->
        <div class="flex-1 flex flex-col overflow-hidden">
            <!-- Header -->
            <div id="header-container"></div>
            
            <!-- Main Content Area -->
            <main class="flex-1 overflow-y-auto p-6">
                <div class="max-w-4xl mx-auto bg-white rounded-lg shadow-md overflow-hidden">
                    <div class="p-6">
                        <h1 class="text-2xl font-bold text-gray-800 mb-6">My Profile</h1>
                        
                        <div class="flex flex-col md:flex-row gap-8">
                            <!-- Profile Picture Section -->
                            <div class="w-full md:w-1/3">
                                <div class="bg-gray-50 p-6 rounded-lg border border-gray-200">
                                    <div class="text-center">
                                        <div class="relative mx-auto w-40 h-40 rounded-full overflow-hidden border-4 border-white shadow-lg" id="profileImageContainer">
                                            <img id="profileImage" src="" alt="Profile" class="w-full h-full object-cover hidden">
                                            <div id="profileInitials" class="w-full h-full bg-blue-600 text-white flex items-center justify-center text-4xl font-bold"></div>
                                        </div>
                                        
                                        <div class="mt-4">
                                            <label class="cursor-pointer inline-flex items-center px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors">
                                                <i class="fas fa-camera mr-2"></i>
                                                Change Photo
                                                <input type="file" id="profilePhotoInput" class="hidden" accept="image/*">
                                            </label>
                                            <p class="text-xs text-gray-500 mt-2">JPG, GIF or PNG. Max size 2MB</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Profile Information -->
                            <div class="w-full md:w-2/3">
                                <form id="profileForm" class="space-y-4">
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                        <div>
                                            <label for="firstName" class="block text-sm font-medium text-gray-700 mb-1">First Name</label>
                                            <input type="text" id="firstName" name="firstName" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                        </div>
                                        <div>
                                            <label for="lastName" class="block text-sm font-medium text-gray-700 mb-1">Last Name</label>
                                            <input type="text" id="lastName" name="lastName" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                        </div>
                                    </div>
                                    
                                    <div>
                                        <label for="email" class="block text-sm font-medium text-gray-700 mb-1">Email Address</label>
                                        <input type="email" id="email" name="email" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                    </div>
                                    
                                    <div>
                                        <label for="phone" class="block text-sm font-medium text-gray-700 mb-1">Phone Number</label>
                                        <input type="tel" id="phone" name="phone" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                    </div>
                                    
                                    <div class="pt-2">
                                        <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2">
                                            Save Changes
                                        </button>
                                    </div>
                                </form>
                                
                                <div class="mt-8 pt-6 border-t border-gray-200">
                                    <h3 class="text-lg font-medium text-gray-900 mb-4">Change Password</h3>
                                    <form id="passwordForm" class="space-y-4">
                                        <div>
                                            <label for="currentPassword" class="block text-sm font-medium text-gray-700 mb-1">Current Password</label>
                                            <input type="password" id="currentPassword" name="currentPassword" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                        </div>
                                        <div>
                                            <label for="newPassword" class="block text-sm font-medium text-gray-700 mb-1">New Password</label>
                                            <input type="password" id="newPassword" name="newPassword" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                        </div>
                                        <div>
                                            <label for="confirmPassword" class="block text-sm font-medium text-gray-700 mb-1">Confirm New Password</label>
                                            <input type="password" id="confirmPassword" name="confirmPassword" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                        </div>
                                        <div class="pt-2">
                                            <button type="submit" class="px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2">
                                                Update Password
                                            </button>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <script src="js/common.js"></script>
    <script>
        // Utility: Show toast using header component container when available
        function showToast(message, type = 'success') {
            const toast = document.getElementById('toast');
            const toastMessage = document.getElementById('toast-message') || document.getElementById('toastMessage');
            if (toast && toastMessage) {
                toastMessage.textContent = message;
                toast.className = `fixed top-4 right-4 p-4 rounded-md shadow-lg z-50 flex items-center ${type === 'success' ? 'bg-green-500' : 'bg-red-500'} text-white`;
                toast.classList.remove('hidden');
                setTimeout(() => toast.classList.add('hidden'), 3000);
            } else {
                alert(message);
            }
        }

        // Initialize page-specific behavior after DOM and components are ready
        document.addEventListener('DOMContentLoaded', function() {
            // Simulated load of user data (replace with real API)
            const data = {
                firstName: 'John',
                lastName: 'Doe',
                email: 'john.doe@unza.zm',
                phone: '+260 97 123 4567',
                avatar: ''
            };
            document.getElementById('firstName').value = data.firstName;
            document.getElementById('lastName').value = data.lastName;
            document.getElementById('email').value = data.email;
            document.getElementById('phone').value = data.phone;
            updateProfileImage(data.avatar, data.firstName, data.lastName);

            // Profile form submission
            document.getElementById('profileForm').addEventListener('submit', function(e) {
                e.preventDefault();
                const formData = {
                    firstName: document.getElementById('firstName').value.trim(),
                    lastName: document.getElementById('lastName').value.trim(),
                    email: document.getElementById('email').value.trim(),
                    phone: document.getElementById('phone').value.trim()
                };
                console.log('Updating profile:', formData);
                showToast('Profile updated successfully', 'success');
                // Update initials/avatar
                updateProfileImage('', formData.firstName, formData.lastName);
                // Reflect name in header if present
                const userName = document.getElementById('userName');
                if (userName) userName.textContent = `${formData.firstName} ${formData.lastName}`;
            });

            // Password form submission
            document.getElementById('passwordForm').addEventListener('submit', function(e) {
                e.preventDefault();
                const newPassword = document.getElementById('newPassword').value;
                const confirmPassword = document.getElementById('confirmPassword').value;
                if (newPassword !== confirmPassword) {
                    showToast('New passwords do not match', 'error');
                    return;
                }
                console.log('Changing password...');
                showToast('Password updated successfully', 'success');
                this.reset();
            });

            // Photo upload
            const fileInput = document.getElementById('profilePhotoInput');
            fileInput.addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (!file) return;
                const validTypes = ['image/jpeg', 'image/png', 'image/gif'];
                if (!validTypes.includes(file.type)) {
                    showToast('Please select a valid image (JPEG, PNG, or GIF)', 'error');
                    return;
                }
                const maxSize = 2 * 1024 * 1024;
                if (file.size > maxSize) {
                    showToast('Image size should not exceed 2MB', 'error');
                    return;
                }
                const reader = new FileReader();
                reader.onload = function(event) {
                    const profileImage = document.getElementById('profileImage');
                    const profileInitials = document.getElementById('profileInitials');
                    profileImage.src = event.target.result;
                    profileImage.classList.remove('hidden');
                    profileInitials.classList.add('hidden');
                    // Update header avatar if present
                    const userAvatarImg = document.querySelector('#userAvatar img');
                    if (userAvatarImg) {
                        userAvatarImg.src = event.target.result;
                        userAvatarImg.classList.remove('hidden');
                        const initials = document.getElementById('userInitials');
                        if (initials) initials.classList.add('hidden');
                    }
                    showToast('Profile photo updated successfully', 'success');
                };
                reader.readAsDataURL(file);
            });
        });

        function updateProfileImage(avatarUrl, firstName, lastName) {
            const profileImage = document.getElementById('profileImage');
            const profileInitials = document.getElementById('profileInitials');
            if (avatarUrl) {
                profileImage.src = avatarUrl;
                profileImage.classList.remove('hidden');
                profileInitials.classList.add('hidden');
            } else {
                profileImage.classList.add('hidden');
                profileInitials.classList.remove('hidden');
                const initials = (firstName ? firstName[0] : '') + (lastName ? lastName[0] : '');
                profileInitials.textContent = initials || 'U';
            }
        }
    </script>
</body>
</html>
